<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Abibotti | Rekisteröidy</title>

  <!-- Styles -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" />
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>

  <!-- Header / Navbar -->
  <header>
    <nav class="navbar">
      <strong class="abibottiLogo">
        <a href="/main.html" >Abibotti</a>
      </strong>
      <ul class="nav-links">
        <li class="nav-item"><a href="/studyhub.html">Yo-Koe</a></li>
        <li class="nav-item"><a href="/contact.html">Ota yhteyttä</a></li>
        <li class="nav-item"><a href="/login.html">Kirjaudu sisään</a></li>
        <li class="nav-item"><a class="primary-btn" href="/signup.html">Aloita</a></li>
      </ul>
    </nav>
  </header>

  <main class="container" style="margin: 2rem auto; max-width: 500px; padding: 1rem;">
    <h2 style="text-align: center; margin-bottom: 2rem; color: var(--background);">Luo uusi tili</h2>
    <form id="signup-form" class="form-grid">
      <label for="fullname">Nimi</label>
      <input type="text" id="fullname" name="fullname" placeholder="Etunimi Sukunimi" required>

      <label for="email">Sähköposti</label>
      <input type="email" id="email" name="email" placeholder="esimerkki@email.com" required>

      <label for="password">Salasana</label>
      <input type="password" id="password" name="password" required>

      <label for="confirm-password">Vahvista salasana</label>
      <input type="password" id="confirm-password" name="confirm-password" required>

      <button type="submit" class="primary-btn" style="margin-top: 1rem; width: 100%; background-color: var(--background); color: var(--light);">
        Rekisteröidy
      </button>

      <div id="signup-error" style="display: none; color: red; text-align: center; margin-top: 1rem;"></div>
    </form>

    <p style="text-align: center; margin-top: 1rem;">
      Onko sinulla jo tili? <a href="/login.html">Kirjaudu sisään</a>
    </p>
  </main>

  <footer style="margin-top: 4rem; text-align: center; font-size: 0.875rem; color: var(--muted);">
    <p>&copy; 2025 Abibotti. Kaikki oikeudet pidätetään.</p>
  </footer>

  <script>
    document.getElementById('signup-form').addEventListener('submit', async function (e) {
      e.preventDefault();

      const form = e.target;
      const data = {
        fullname: form.fullname.value,
        email: form.email.value,
        password: form.password.value,
        'confirm-password': form['confirm-password'].value
      };

      const res = await fetch('/signup', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      const result = await res.json();
      const errorDiv = document.getElementById('signup-error');

      if (!res.ok) {
        errorDiv.style.display = 'block';
        errorDiv.textContent = result.message || 'Virhe tapahtui.';
      } else {
        localStorage.setItem('token', result.token);
        window.location.href = '/dashboard.html';
      }
    });
  </script>
</body>
</html>